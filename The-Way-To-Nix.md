# The Way to Nix

> é¡»çŸ¥ 1ï¼šä½ ä¸åº”å½“ä»æœ¬æ–‡ç« ä¸­ç…§æŠ„ **ä»»ä½•ä½ ä¸ç†è§£çš„å‘½ä»¤å’Œæ“ä½œ!** æˆ‘çš„åšå®¢åªæ˜¯äºŒæ‰‹çŸ¥è¯†ï¼Œå¹¶ä¸”ç¼ºä¹æ—¶æ•ˆæ€§ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦å†™äº NixOS 22.11 ç‰ˆæœ¬ã€‚ä½ å¯¹ä½ æœºå™¨è´Ÿæœ‰ç¬¬ä¸€è´£ä»»ï¼Œæ‰€ä»¥åº”å°½é‡æŒ‰ç…§å—ç»´æŠ¤çš„å®˜æ–¹æ–‡æ¡£æ¥æ‰§è¡Œæ“ä½œå°¤å…¶æ˜¯é«˜å±æ“ä½œï¼ˆå¦‚ **å®‰è£…ç³»ç»Ÿ**ï¼‰ã€‚è€Œæ–‡ç« çš„ä½œç”¨æ˜¯å¸®åŠ©ä½ äº†è§£å’Œç†Ÿæ‚‰é‚£äº›ä¸œè¥¿ï¼Œè¾¾åˆ°ç¥›é­…å’Œæ‰«é™¤è¿·èŒ«çš„æ•ˆæœã€‚
> 
> é¡»çŸ¥ 2ï¼šå…³äºæœ¬æ–‡ä»»ä½•çš„è¡¨è¿°é”™è¯¯ã€è¡¨è¿°ç¼ºå¤±ã€è¡¨è¿°æ¨¡ç³Šï¼Œæ¬¢è¿åœ¨ä¸¤ä¸ªä»“åº“ [github:Yakkhini/YeChaNvCinema](https://github.com/Yakkhini/YeChaNvCinema) å’Œ [github:Yakkhini/nixos-flake](https://github.com/Yakkhini/nixos-flake)ï¼ˆè¿™ä¸ªæš‚ä¸ºç§å¯† repoï¼‰ä¸­æ Issuesã€‚å¦‚æœæ„Ÿè§‰å†…å®¹æœ‰å¸®åŠ©ï¼Œä¹Ÿå¯ä»¥ star è¿™ä¸¤ä¸ªä»“åº“ã€‚

*åŸæ–‡éƒ¨ç½²äº [Yaksis' work - Nix](https://yechanv.vercel.app/#/linux/20220629-nix)*

ä»Šå¹´æ˜¥å¤©çš„æ—¶å€™çŸ¥é“äº† Nix å’Œ Nix OSï¼Œç«‹åˆ»å°±äº§ç”Ÿäº†å¾ˆå¤§å…´è¶£ã€‚æˆ‘æ¯”è¾ƒå–œæ¬¢å®ƒåŸå­åŒ–ç³»ç»Ÿå’Œå‡½æ•°å¼ç”Ÿæˆçš„å“²å­¦ã€‚

ç”¨äº†å¾ˆä¹…çš„ Linux æ¡Œé¢ï¼Œä¹Ÿç®—æ˜¯äº†è§£äº†å…¶ä¸­çš„ä¸€äº›å¥½å¤„å’Œåå¤„ã€‚æœ€ä»¤æˆ‘ä¸æ»¡æ„çš„æ˜¯ Linux ç³»ç»Ÿä¸­å§‹ç»ˆæœ‰ä¸€äº›æ–‡ä»¶æ¸¸ç¦»äºæˆ‘çš„æ§åˆ¶ä¹‹å¤–ã€‚å¤§éƒ¨åˆ†çš„ Linux å‘è¡Œç‰ˆéƒ½æœ‰åŒ…ç®¡ç†å™¨ï¼Œè®©å®ƒçš„æ–‡ä»¶å®‰è£…ç³»ç»Ÿæ¯” Windows ä¸œè£…ä¸€å—ã€è¥¿è£…ä¸€å—çš„ç¹æ‚é”™ä¹±å¥½ä¸Šä¸å°‘ã€‚ä½†æ˜¯æˆ‘çš„ `~/.config` æ–‡ä»¶å¤¹ç°åœ¨ç®€ç›´å°±åƒä¸€åœºç¾éš¾ã€‚å·²è£…çš„å’Œè¢«å¸è½½çš„è½¯ä»¶ï¼Œé‚£äº›é…ç½®æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶å¤¹å †åœ¨ä¸€èµ·ï¼Œä»¤äººå¾ˆä¸æ»¡æ„ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä½¿ç”¨äº†å¾ˆä¹… Linux ç³»ç»Ÿåï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªä»¤äººéš¾è¿‡çš„äº‹æƒ…ï¼šæˆ‘å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“æˆ‘çš„ç”µè„‘ä¸Šç›®å‰è£…äº†å¤šå°‘ä¸ªè½¯ä»¶ï¼Œæ¯ä¸ªè½¯ä»¶æ˜¯å¹²ä»€ä¹ˆç”¨çš„ã€å“ªä¸ªè½¯ä»¶å…¶å®æ˜¯æ²¡ä»€ä¹ˆå¿…è¦ã€å¯ä»¥å¸è½½çš„ã€‚

æ˜¯çš„ï¼Œè™½ç„¶æˆ‘æœ‰åŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥ä½¿ç”¨ `yay -Qs` å‘½ä»¤æ¥è¾“å‡ºæˆ‘æœ¬åœ°æ‰€æœ‰çš„å·²è£…è½¯ä»¶ï¼Œä½†åˆ†è¾¨å®ƒä»¬æ¯ä¸€ä¸ªä»æ˜¯ä¸€ä»¶ä¸å®¹æ˜“çš„äº‹ã€‚æˆ‘çš„ç”µè„‘ä¸Šå¯èƒ½å·²ç»è£…äº†æ•°ç™¾ä¸ªè½¯ä»¶åŒ…ï¼Œä½†æˆ‘æ²¡æœ‰æ—¶é—´å»æŠŠå®ƒä»¬æ¯ä¸€ä¸ªéƒ½æ¢³ç†æ¸…æ¥šã€‚Linux ç¢ç‰‡åŒ–çš„è½¯ä»¶ç”Ÿæ€å¸¦ç»™äº†æˆ‘ä»¬ç®€æ´ã€æ–¹ä¾¿å’Œè½»å·§çš„ç³»ç»Ÿä½¿ç”¨ä½“éªŒï¼Œä½†è¿™ç§ç¢ç‰‡åŒ–åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¸ºæˆ‘ä»¬ç®¡ç†è‡ªå·±çš„ç³»ç»Ÿå¸¦æ¥äº†ä¸€äº›å›°éš¾ã€‚

åœ¨æˆ‘çœ‹æ¥ï¼ŒLinux çš„å‘å±•å†å²å°±æ˜¯ä¸€ä¸ªåœ¨ç»Ÿåˆå’Œç¢ç‰‡ä¸­æ‰¾å¹³è¡¡çš„å†å²ï¼ŒåŠªåŠ›åœ¨è¿™äºŒå…ƒä¸­å¯»æ‰¾å¹¶å­˜çš„å†å²ã€‚ç³»ç»Ÿä¸­æœ‰æ–‡ä»¶ç³»ç»Ÿã€ç¡¬ä»¶ç³»ç»Ÿã€è¿›ç¨‹ç®¡ç†ç³»ç­‰æ¨¡å—ï¼ˆç¢ç‰‡ï¼‰ï¼Œäºæ˜¯ Linux è®¾è®¡äº†â€œä¸€åˆ‡çš†æ–‡ä»¶â€çš„è®¾è®¡å“²å­¦æ¥ç»Ÿåˆï¼›ä¸ªäººå¼€å‘è€…éš¾ä»¥æ‰¿æ‹…å¤§å‹å¼€æºé¡¹ç›®çš„å¼€å‘ï¼ˆç¢ç‰‡ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬é€æ¸å¼€å§‹ä½¿ç”¨ Git ç­‰å·¥å…·ã€å¼€æºç¤¾åŒºçš„å»ºç«‹æ¥å¯¹é½ç¢ç‰‡å¼€å‘è€…çš„åä½œï¼›å„ä¸ªè½¯ä»¶åŒ…ä¹‹é—´éœ€è¦é…åˆæ‰èƒ½ååŒä½¿ç”¨ï¼ˆç¢ç‰‡ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬åœ¨åŒ…ç®¡ç†å™¨ä¸­å¼•å…¥ä¾èµ–åˆ†æç­‰ç‰¹æ€§æ¥å¤„ç†è¿™äº›äº‹åŠ¡ã€‚

å¯ä»¥è¯´ï¼Œè¿™å°±æ˜¯æˆ‘å–œæ¬¢å¼€æºä¸–ç•Œçš„åŸå› ä¹‹ä¸€â€”â€”å®ƒåŠªåŠ›åœ°é¿å…ä¸­å¿ƒåŒ–ä¸é›†æƒçš„åŒæ—¶ï¼Œä¹Ÿæ³¨é‡æ¯ä¸€ä¸ªç‹¬ç«‹ä¸ªä½“ä¹‹é—´çš„åˆä½œï¼Œç»Ÿåˆå‡ºæœ‰æ•ˆã€ç†æ™ºã€å¯ç”¨çš„æ–¹æ¡ˆæ¥ã€‚æˆ‘è®¤ä¸ºåœ¨æœªæ¥çš„ä¸–ç•Œä¸­è¿™ä¸€ç§æ€æƒ³ä¼šèµ°å¾—æ›´è¿œã€‚

è€Œç°åœ¨ï¼Œåœ¨ Nix ä¸­è¿™ä¸€è·¯çº¿å»¶ç»­ä¸‹å»äº†ã€‚å®ƒå°Šé‡è½¯ä»¶çš„ç¢ç‰‡åŒ–ï¼Œå¹¶åŠªåŠ›ç»Ÿåˆè¿™äº›ç¢ç‰‡æä¾›ç»™æˆ‘ä»¬ã€‚

å†³å®šå°è¯• Nix çš„å¥‘æœºæœ‰äºŒã€‚é¦–å…ˆæ¥è®²ï¼ŒNix å’Œ Nix OS æ˜¯ä¸¤ä¸ªæœ‰å…³ç³»ä½†æ€§è´¨ä¸åŒçš„äº‹ç‰©ã€‚åè€…ä»£è¡¨ä¸€ä¸ªå‘è¡Œç‰ˆï¼Œå‰è€…åªæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ã€‚Nix åŒ…ç®¡ç†å™¨çš„å®‰è£…å¹¶æ²¡æœ‰ä»€ä¹ˆå‰ç½®æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¤§å¯ä»¥ç›´æ¥é€æ­¥ç”¨å®ƒä»£æ›¿ä½ ç›®å‰ä½¿ç”¨ç³»ç»Ÿçš„å‘è¡Œç‰ˆå®˜æ–¹åŒ…ç®¡ç†å™¨ã€‚å®é™…ä¸Šï¼Œ**æ¸è¿›å¼** çš„æ€æƒ³åœ¨æ•´ä¸ª Nix ä¸–ç•Œä¸­è´¯ç©¿åˆ°åº•ã€‚ä½ å¯ä»¥ä¸å¿…è´¹å¾ˆå¤§åŠ›æ°”ï¼Œæ¯”å¦‚é‡è£…ä½ ç°åœ¨çš„ç³»ç»Ÿå°±èƒ½æ„Ÿå—åˆ°å®ƒã€‚è€Œå½“ä½ å†³å®šä½¿ç”¨ Nix OS æ—¶ï¼Œå®ƒ **NIXOS_LUSTRATE** çš„å®‰è£…ç‰¹æ€§ç”šè‡³å¯ä»¥è®©ä½ ç›´æ¥åœ¨æœ¬ç³»ç»Ÿä¸­è¿›è¡Œå®‰è£…å’Œæ›¿æ¢å·¥ä½œã€‚

> *ã€ŒBecause Nix (the package manager) & Nixpkgs (the Nix packages collection) can both be installed on any (most?) Linux distributions, they can be used to install NixOS in various creative ways. You can, for instance:*
> 
> [...]
> 
> *ã€Œ2.Install NixOS on the same partition (in place!), from your existing non-NixOS Linux distribution using **NIXOS_LUSTRATE**.ã€*
> 
> â€”â€” NixOS - NixOS 22.05 manual

æˆ‘å¾ˆå–œæ¬¢è¿™ç§æ¸è¿›å¼çš„å“²å­¦ã€‚æƒ³å°é²œ Nix çš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œä¸ä¹…å‰å®ƒç»ˆäºè¿›å…¥äº† Arch çš„ Community è½¯ä»¶åº“ï¼ˆè¯¦è§ [Arch Linux - nix](https://archlinux.org/packages/community/x86_64/nix/)ï¼‰ã€‚è¿™ä»£è¡¨ç€ Nix åŒ…çš„æ‰“åŒ…è´¨é‡æœ‰äº†ä¿è¯ã€‚

## Nix package manager

å¯¹äºæ˜¯å¦è¦ç”¨ Pacman å®‰è£… Nixï¼Œæˆ‘ä¸ªäººè¿˜æ˜¯æœ‰äº›çº ç»“çš„ã€‚å¯¹äºä¸€èˆ¬çš„è½¯ä»¶ï¼Œä¿æŒåŒ…ç®¡ç†å™¨å¯¹å…¶çš„è¿½è¸ªæ˜¯ä¸€ä¸ªè‰¯å¥½å¹¶ä¸”åº”å½“åšæŒçš„ä¹ æƒ¯ï¼›ä½†æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨æ˜¯å¦æœ‰èµ„æ ¼å»å®‰è£…å¦ä¸€ä¸ªåŒ…ç®¡ç†å™¨å‘¢ï¼Ÿæ¯•ç«Ÿï¼Œå½“ä½ åœ¨ä½¿ç”¨ PKGBUILD çš„æ—¶å€™ï¼Œå°±ç›¸å½“äºæˆ–å¤šæˆ–å°‘åœ°æ”¹å˜äº†å®˜æ–¹çš„å®‰è£…è„šæœ¬è®¾è®¡ã€‚å¯¹ä¸€èˆ¬è½¯ä»¶æ¥è¯´ï¼Œè¿™æ ·åšæ— ä¼¤å¤§é›…ï¼Œç”šè‡³æ›´å¥½ï¼Œå› ä¸º Pacman ä¼šå¯¹è¿™äº›ä¿®æ”¹çš„éƒ¨åˆ†è´Ÿè´£ï¼Œè¿™ç§åˆç†çš„æŒæ§ä¹Ÿæ›´åˆ©äºè½¯ä»¶åŒ…ä¸ Arch ååŒã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„æœŸå¾…ä¸­ï¼ŒNix å¯¹ Pacman å¹¶ä¸æ˜¯ä»å±è€Œæ˜¯æ›¿ä»£çš„å…³ç³»ã€‚è¿™æš—å«äº†ä¸€ä»¶äº‹æƒ…ï¼šå½“ Nix é€æ­¥æ›¿ä»£ Pacman åˆ°æœ€åï¼ŒPacman å”¯ä¸€åšçš„äº‹å°±æ˜¯ä¸ºå®‰è£… Nix çš„ PKGBUILD è´Ÿè´£ã€‚è€Œå½“æˆ‘ä»¬çš„ç³»ç»ŸçœŸæ­£å¤±å»äº† Pacman æ—¶ï¼Œç”± PKGBUILD å®‰è£…çš„ Nix å°±å¤±å»äº†å®ƒçš„è´Ÿè´£è€…ã€‚

> *ã€ŒThere are two choices for a Nix installation, **one is supported by Arch Linux,** and **the other is officially supported by Nix.ã€***
> 
> â€”â€” Nix - ArchWiki

è¯šç„¶ï¼Œæˆ‘ç›¸ä¿¡ Community è½¯ä»¶åº“çš„æ‰“åŒ…è´¨é‡ï¼ŒNix æœ€ç»ˆå®‰è£…åˆ°æˆ‘ç³»ç»Ÿé‡Œçš„å®é™…ä½“éªŒæ˜¯å®Œå¥½çš„ã€ç”šè‡³ä¸è„šæœ¬å®‰è£…åˆ°æˆ‘ç³»ç»Ÿç›®å½•ä¸­çš„é«˜æƒé™æ–‡ä»¶æ²¡æœ‰åŒºåˆ«ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªç¨‹åºæ­£ä¹‰çš„é—®é¢˜ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬çŸ¥é“ Nix ä¸ Nix OS åœ¨æœ€ç»ˆçš„æ¨¡æ ·æ‘†è„±äº† FHS æ–‡ä»¶ç›®å½•ç»„ç»‡è§„èŒƒï¼Œè¿™ä¸ Arch çš„æ‰“åŒ…è§„èŒƒæ˜¯å¦æœ‰å†²çªï¼Ÿè¿™äº›æ˜¯åœ¨åˆç†æ¨æµ‹ä¸­ï¼Œå°†æ¥å¯èƒ½ä¼šå‡ºç°çš„é›·ç‚¹ã€‚

ä¸è¿‡è¿™ç›®å‰å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§ä¸äº†çš„é—®é¢˜ã€‚æˆ‘ç›®å‰å¯ä»¥æš‚æ—¶ä½¿ç”¨ Nix éƒ¨åˆ†æ›¿ä»£ Pacmanï¼Œåœ¨æœ€åæƒ³è¦å®‰è£… Nix OS æ—¶å†ä»å®˜æ–¹è„šæœ¬ä¸­é‡æ–°å®‰è£…å°±å¥½ã€‚é‚£ä¹ˆæˆ‘æ‹…å¿ƒçš„é—®é¢˜å°±å˜æˆäº†åœ¨é‚£ä¸ªæ—¶å€™å®˜æ–¹çš„ Nix èƒ½å¦æ¥ç®¡æˆ‘åŸå…ˆ Nix çš„å·¥ä½œï¼Œç»§ç»­è¿½è¸ªä¹‹å‰å®‰è£…çš„è½¯ä»¶åŒ…äº†ã€‚è¿™ä¸€ç‚¹æˆ‘æƒ³æ˜¯æ¯”è¾ƒå®¹æ˜“è¢«è§£å†³çš„ï¼Œå› ä¸º Nix ä½œä¸ºå‡½æ•°å¼åŒ…ç®¡ç†å™¨ï¼Œæ‘§æ¯ä¸å¤ç°æ˜¯å®ƒçš„å¼ºé¡¹ã€‚å¯èƒ½æˆ‘åˆ°æ—¶å€™åªéœ€è¦æ”¹åŠ¨ä¸€ä¸‹é…ç½®å£°æ˜æ–‡ä»¶å°±å¥½äº†ã€‚æˆ–è€…ï¼Œæˆ‘åœ¨å­¦ä¹ ä½¿ç”¨ Nix ä»¥åŠ Linux åŒ…ç®¡ç†ç³»ç»Ÿçš„è¿‡ç¨‹ä¸­å°±èƒ½æ‰¾åˆ°è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ï¼Œç”šè‡³æœ€ç»ˆå‘ç°æˆ‘æ ¹æœ¬æ˜¯åœ¨æ‹…å¿ƒä¸€äº›ä¸å­˜åœ¨çš„é—®é¢˜ã€‚

æ‰€ä»¥è¯´ï¼Œæˆ‘ç›®å‰æ‰“ç®—ä» Official repositories ä¸­å®‰è£… Nixï¼Œå‰©ä¸‹çš„ä»é•¿è®¡è®®ã€‚

> *æ³¨ï¼šåœ¨åç»­çš„å®‰è£… NixOS è¿‡ç¨‹ä¸­å‘ç°ï¼Œä» Arch repositories ä¸­å®‰è£…çš„ Nix ä¼šäº§ç”Ÿå„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚æŒ‰ç…§ Nix Community çš„å»ºè®®ï¼Œè¿˜æ˜¯æŒ‰ç…§å®˜æ–¹é€”å¾„ï¼Œcurl å®‰è£…è„šæœ¬æ¥å®‰è£…ä¼šæ¯”è¾ƒå¥½ã€‚*

```bash
> yay -S nix
```
åœ¨å®‰è£… Nix åï¼Œä½¿ç”¨å‰é¦–å…ˆè¦å°†ç”¨æˆ·æ·»åŠ åˆ° nix-users ç”¨æˆ·ç»„ä¸­ï¼Œå¹¶å¯åŠ¨ Nix çš„ daemon æœåŠ¡ã€‚

```bash
> gpasswd -a username nix-users
> systemctl enable nix-daemon.service
> systemctl start nix-daemon.service
```

æ¥ç€å°±å¯ä»¥æŒ‰ç…§ Arch Wiki ä¸­çš„æ­¥éª¤ï¼Œåœ¨æ›´æ–°å®˜æ–¹æºåå®‰è£…ä¸€ä¸ª hello è½¯ä»¶åŒ…ã€‚

```bash
> nix-channel --add https://nixos.org/channels/nixpkgs-unstable
> nix-channel --update
> nix-env -iA nixpkgs.hello

> hello
```

**OUTPUT:**

```
Hello, world!
```

## NixOS Installment

å¦‚ä½•å®‰è£… NixOS åœ¨ [NixOS Manual](https://nixos.org/manual/nixos/stable/) ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚æœ¬æ–‡æ¯”è¾ƒå…·æœ‰ç‰¹è‰²çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘æ‰“ç®—ä½“éªŒ NixOS çš„ **LUSTRATE** åŠŸèƒ½ã€‚æˆ‘çš„æœºå™¨æ˜¯åœ¨ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ä¸­è¿›è¡Œçš„ï¼š

* æœ¬æœºåœ¨å®‰è£…å‰ä½¿ç”¨ Manjaro ç³»ç»Ÿï¼Œå®‰è£…åä¸º NixOS 22.11 ç³»ç»Ÿï¼›
* æœ¬æœºä¸­é™¤äº† Linuxï¼Œè¿˜æœ‰ä¸€ä¸ª Windows 10 ç³»ç»Ÿï¼Œå’Œ Manjaro ä¸€èµ·ä½¿ç”¨ Grub å¼•å¯¼ï¼›
* æœ¬æœºå®‰è£… NixOS æ²¡æœ‰å¯¹åˆ†åŒºæˆ–è€… Manjaro åšä»»ä½•æ ¼å¼åŒ–å’Œæ•°æ®æ¸…é™¤ï¼Œç›´æ¥åœ¨åŸç³»ç»Ÿè¿è¡Œä¸­ä½¿ç”¨ **LUSTRATE** å°†å…¶æ›¿æ¢æˆ NixOSã€‚

> *ã€Œlustrate /ËˆlÊŒstreÉªt/ verb.ã€*
>
> *ã€Œpurify by expiatory sacrifice, ceremonial washing, or some other ritual action.ã€*
>
> â€”â€” NixOS - NixOS 22.11 manual

### å®Œç¾åœ°ä» Arch ç³»å‘è¡Œç‰ˆä¸­å¸è½½ Nix åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä»å®˜æ–¹æºå•ç”¨æˆ·é‡è£…

åœ¨å°è¯•è¿‡ Nix åŒ…ç®¡ç†å™¨åï¼Œæƒ³è¦è½¬ç§»åˆ° NixOSè¿™ä¸€å‘è¡Œç‰ˆçš„æƒ³æ³•ç”±ç„¶è€Œç”Ÿã€‚ä½¿ç”¨ **LUSTRATE** å®‰è£…çš„æ­¥éª¤åœ¨ [NixOS Manual 2.4.5.Â Installing from another Linux distribution](https://nixos.org/manual/nixos/stable/index.html#sec-installing-from-other-distro) ä¸€èŠ‚ä¸­å¯ä»¥æ‰¾åˆ°ã€‚æ³¨æ„æ­¥éª¤ 4 åˆ° 8 å¯¹äº **LUSTRATE** å¯ä»¥å¿½ç•¥ï¼ˆè¯¦è§ Noteï¼‰ã€‚

ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œæˆ‘çš„æœºå™¨åœ¨æŒ‰ç…§æ­¥éª¤å®‰è£…æ—¶æ€»ä¼šäº§ç”Ÿä¸€äº›ä¸è¢«æœŸæœ›çš„ç»“æœã€‚æˆ‘çŒœæµ‹è¿™æ˜¯å› ä¸ºæˆ‘çš„ Manjaro å·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°ï¼Œå¯¼è‡´ nix ç‰ˆæœ¬è€æ—§ï¼Œä¸ NixOS 22.11 ä¸åŒ¹é…çš„ç»“æœã€‚åŒæ—¶ï¼Œä½¿ç”¨ pacman å®‰è£…çš„ nix åŒ…æ˜¯å¤šç”¨æˆ·å®‰è£…ï¼Œä¸æ‰‹å†Œä¸­çš„å•ç”¨æˆ·å®‰è£…ä¸ç¬¦ã€‚

æ€»ä¹‹ï¼Œæˆ‘æƒ³ä¹‹å‰å…³äºæ˜¯å¦è¦ä½¿ç”¨ Pacman å®‰è£… nix çš„æ‹…å¿ƒæˆä¸ºäº†ç°å®ã€‚æœ€å¥½çš„åŠæ³•ï¼Œå°±æ˜¯å®Œå…¨åˆ é™¤ä¹‹å‰çš„ nixï¼Œå¹¶ä» nix å®˜æ–¹æºå®‰è£…ï¼Œä»¥ä¿è¯æˆ‘å®‰è£… NixOS çš„ç³»ç»ŸçŠ¶æ€å°½é‡ä¸ Manual ä¸€è‡´ã€‚

å®Œå…¨åˆ é™¤ nix å¯ä»¥åœ¨ [Nix Manual - Installing a Binary Distribution#uninstalling](https://nixos.org/manual/nix/stable/installation/installing-binary.html#uninstalling) ä¸­æ‰¾åˆ°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä½¿ç”¨ Pacman åˆ é™¤ nix æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜æœ‰ nix é—ç•™ç›¸å…³è·¯å¾„ã€ç”¨æˆ·å’Œç”¨æˆ·ç»„ç­‰éœ€è¦å¤„ç†ã€‚

```bash
# é¦–å…ˆè¦ä» pacman æœ¬åœ°è½¯ä»¶åº“ä¸­å¸è½½ nix
> yay -R nix

# åˆ é™¤ä¸ nix æœ‰å…³çš„æ‰€æœ‰è·¯å¾„
> sudo rm -rf /nix /etc/nix /etc/profile/nix.sh ~root/.nix-profile ~root/.nix-defexpr ~root/.nix-channels ~/.nix-profile ~/.nix-defexpr ~/.nix-channels

# åˆ é™¤ä¸ nix æœ‰å…³çš„ç”¨æˆ·ç­‰ã€‚ä½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡ Pacman åˆ›å»ºçš„
# ç›¸å…³ç”¨æˆ·åŠç”¨æˆ·ç»„åç§°å’Œ id å¯èƒ½ä¸ä¸‹æ–¹ Nix Manual ä¸­æ‰€ç¤ºä¸åŒï¼Œ
# éœ€è¦æ‰‹åŠ¨æŸ¥çœ‹æœ¬æœºçš„ç”¨æˆ·åŠç”¨æˆ·ç»„ååˆ é™¤ç›¸å…³å†…å®¹ã€‚
> for i in $(seq 30001 30032); do\
  sudo userdel $i\
done\
sudo groupdel 30000

# åœæ­¢ç›¸å…³æœåŠ¡
> sudo systemctl stop nix-daemon.socket
> sudo systemctl stop nix-daemon.service
> sudo systemctl disable nix-daemon.socket
> sudo systemctl disable nix-daemon.service
> sudo systemctl daemon-reload

```

æ¥ç€ï¼Œæ ¹æ® NixOS Manual 2.4.5. è¿›è¡Œ nix å•ç”¨æˆ·å®‰è£…ï¼š

```bash
> curl -L https://nixos.org/nix/install | sh
```

ç„¶åéµå¾ªå…¶æ­¥éª¤ç»§ç»­ä¿®æ”¹ channelï¼Œå®‰è£…å·¥å…·åŒ…ã€‚æ³¨æ„ï¼Œæ­¤å¤„ channel æ›´æ”¹ä¸ nix å¸¸è§„å®‰è£…æœ‰æ‰€ä¸åŒï¼Œä»¥ NixOS Manual ä¸ºå‡†ã€‚

### åˆæ¢ configuration.nix

ç”Ÿæˆ `configuration.nix` æ–‡ä»¶ã€‚

```bash
sudo `which nixos-generate-config`
```

ç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶ä¼šå­˜æ”¾åœ¨ /etc/nixos è·¯å¾„ä¸­ã€‚`hardware-configuration.nix` ç”¨äºå£°æ˜æ–°ç³»ç»Ÿçš„ç¡¬ä»¶å’Œé©±åŠ¨ç­‰ï¼Œç”±å·¥å…·åŒ…è‡ªåŠ¨æ£€æµ‹ä½ çš„ç¡¬ä»¶çŠ¶æ€ç”Ÿæˆã€‚ä¸ç”¨ä¿®æ”¹å®ƒï¼Œé™¤éä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚åœ¨æ¥ä¸‹æ¥çš„æ—…ç¨‹ä¸­ï¼Œ`configuration.nix` ä¼šé™ªä¼´æˆ‘ä»¬å¾ˆä¹…ã€‚å¦‚æœä½ ä¸æ‰“ç®—ä½¿ç”¨ **Flake** æ¥å£°æ˜ä½ çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ä¼šé™ªä¼´ä½ ä½¿ç”¨ NixOS çš„æ¯ä¸€å¤©ã€‚

ä½¿ç”¨ vim æ‰“å¼€å®ƒï¼Œè¿›è¡Œä¸€äº›é…ç½®å§ã€‚

#### åŒå¼•å¯¼ç³»ç»Ÿå¦‚ä½•é…ç½® Grub

é¦–å…ˆä½ åº”è¯¥çœ‹åˆ°çš„æ˜¯ `boot.loader` é€‰é¡¹ã€‚ç”±äºæˆ‘çš„æœºå™¨å†…è¿˜æœ‰ä¸€ä¸ª Windows 10 åŒç³»ç»Ÿï¼Œåœ¨ä¹‹å‰å°±é‡‡ç”¨ GRUB 2 æ¥è¿›è¡Œå¼•å¯¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ systemd-boot æ¥å¼•å¯¼å¯åŠ¨äº†ã€‚å…³äºè¿™ä¸€éƒ¨åˆ†å¦‚ä½•é…ç½®ï¼Œä½ å¯ä»¥çœ‹ NisOS Manual 2.3.3 ç¬¬ 4 æ­¥éª¤è¯¦è§£ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹é™„å½•çš„ Options ä¸­å…³äº [boot.loader.grub](https://nixos.org/manual/nixos/stable/options.html#opt-boot.loader.grub.enable) å’Œ [boot.loader.systemd-boot](https://nixos.org/manual/nixos/stable/options.html#opt-boot.loader.systemd-boot.enable) å†…å®¹è¯¦è§£ã€‚åœ¨å¼€å§‹ä½¿ç”¨ `configuration.nix` åï¼Œæˆ‘ä»¬ä¼šæ…¢æ…¢å¼€å§‹å­¦ç€æŸ¥é˜…è¿™ä¸ªé™„å½•ã€‚å¦‚æœä½ æƒ³è¦è¿›ä¸€æ­¥å…³äº GRUB å’Œ systemd-boot çš„çŸ¥è¯†ï¼Œå¯ä»¥å»æŸ¥é˜…å®ƒä»¬çš„ Arch wikiï¼š[GRUB](https://wiki.archlinux.org/title/GRUB)ï¼Œ[systemd-boot](https://wiki.archlinux.org/title/Systemd-boot)ã€‚å¦‚æœä½ æƒ³çœ‹ä¸€çœ‹æœ‰å…³åŒç³»ç»Ÿå¼•å¯¼çš„å…¶ä»–åšå®¢ï¼Œæˆ‘åœ¨çŸ¥ä¹ä¸Šæ‰¾åˆ°äº† [NixOS ä¸ Windows åŒç³»ç»Ÿå¯åŠ¨å®‰è£…æ•™ç¨‹ - çŸ¥ç‹](https://zhuanlan.zhihu.com/p/441190715)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒçŸ¥ç‹çš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œè€Œä½ ä¸å¿…åƒä»–ä¸€æ ·å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬ä½œä¸ºåˆå­¦è€…æœ€é‡è¦çš„æ˜¯è®© NixOS é¡ºåˆ©è·‘èµ·æ¥å³å¯ï¼Œä¹Ÿå°±æ˜¯ **å°½å¯èƒ½åªåšå¿…è¦çš„äº‹ã€‚**

æˆ‘æ¥å±•ç¤ºä»¥ä¸‹æˆ‘çš„ `boot.loader` é…ç½®ç‰‡æ®µã€‚

```nix
...
# Use the GRUB boot loader.
  boot.loader = {
    efi.canTouchEfiVariables = true;
    efi.efiSysMountPoint = "/boot/efi";

    grub = {
      enable = true;
      device = "nodev";
      efiSupport = true;
      useOSProber = true;
    };
  };
...
```

æˆ‘æƒ³ä½ åœ¨é˜…è¯»ä»¥ä¸Šä¿¡æ¯åï¼Œä¹Ÿèƒ½å†™å‡ºé€‚åˆä½ æœºå™¨çš„ã€æ¯”è¾ƒç²¾ç®€çš„é…ç½®ã€‚åœ¨è¿™ä¸€é…ç½®ä¸­æˆ‘ efi æŒ‚è½½ç‚¹æ˜¯ `/boot/efi` è€Œä¸æ˜¯é»˜è®¤çš„ `/boot`ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå…¶å®æˆ‘ä¸€å¼€å§‹ä¹Ÿå°†å…¶è®¾å®šä¸º `/boot` ä½†æ˜¯æ— æ³•è·‘é€šã€‚é€šè¿‡ `/etc/fstab` çœ‹åˆ°æˆ‘çš„æŒ‚è½½è®¾ç½®åæˆ‘çŸ¥é“äº†åŸå› ï¼š

```fs
...
# /dev/nvme0n1p1 LABEL=ESP
UUID=FAFF-EE0B      	/boot/efi 	vfat      	rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,errors=remount-ro	0 0
...
```

æˆ‘çš„ efi ç¡¬ç›˜åˆ†åŒºè¢«æŒ‚è½½åˆ°äº† `/boot/efi` ä¸Šã€‚

#### å°½å¯èƒ½ç²¾ç®€é…ç½®

æ–°äººå®‰è£… NixOS çš„ä¸€ä¸ªè¯¯åŒºåœ¨äºï¼šä»–ä»¬æƒ³åœ¨å®‰è£… NixOS ä¹‹å‰å°±æŠŠé…ç½®æ–‡ä»¶å†™å¾—å¾ˆå¤æ‚ï¼Œæƒ³è¦è‡ªå·±çš„æ¡Œé¢åœ¨å®‰è£…åç¬¬ä¸€æ¬¡å¯åŠ¨å°±æœ‰ç²¾å½©çš„æ•ˆæœã€‚ä½†å®é™…ä¸Šè¿™æ˜¯ä»–ä»¬å®‰è£…å¤±è´¥ï¼Œæˆ–è€…ç³»ç»Ÿæ— æ³•å¯åŠ¨çš„æ ¹æºä¹‹ä¸€ã€‚**æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç³»ç»Ÿçš„ä¿¡æ¯ç†µè¶Šå¤§ï¼Œè¿™ä¸ªç³»ç»Ÿå°±è¶Šéš¾ç®¡ç†ã€‚æ‰€ä»¥ï¼Œè¯·å°½é‡ç²¾ç®€ä½ çš„é…ç½®ã€‚**ä½ åªéœ€è¦åœ¨é»˜è®¤ç”Ÿæˆçš„æ¨¡æ¿ä¸­å»æ‰ä¸€äº›æ³¨é‡Šï¼Œå°±å¯ä»¥è¿›å…¥ NixOS çš„ consoleã€‚ç¬¬ä¸€æ¬¡æˆåŠŸå¯åŠ¨åå†æ…¢æ…¢ç®¡ç†ç³»ç»Ÿçš„æ¼”è¿›æ˜¯ä¸€ä¸ªä¸é”™çš„ç­–ç•¥ã€‚

æˆ‘çš„ç¬¬ä¸€æ¬¡å®‰è£…ï¼Œå»æ‰äº† networkmanager çš„æ³¨é‡Šï¼Œè®¾ç½® timeZone ä¸º `"Asia/Shanghai"`ï¼Œå»æ‰äº† `xserver.enable` çš„æ³¨é‡Šå’Œ `sound.enable`ï¼ŒåŠ pulseaudio çš„æ³¨é‡Šï¼Œç®€å•åœ°è®¾ç½®äº† userï¼Œå…³é—­äº†é˜²ç«å¢™ `networking.firewall.enable = false`ã€‚ç®€å•é…ç½®äº† i18n çš„å­—ä½“ï¼Œåœ¨ `sysemPackages` å»æ‰äº† vim çš„æ³¨é‡Šï¼Œå¹¶é¢å¤–å®‰è£…äº† rangerã€‚

è¿™å·²ç»è¶³å¤Ÿã€‚è‡³äºå›¾å½¢ç•Œé¢ã€è¾“å…¥æ³•ã€çª—å£ç®¡ç†å™¨ç­‰æˆ‘å®Œå…¨å¯ä»¥åœ¨å®‰è£…æˆåŠŸè¿›å…¥ç³»ç»Ÿåå†è¿›ä¸€æ­¥é…ç½®ã€‚

### å®‰è£… NixOS

æŒ‰æ‰‹å†ŒæŒ‡å¯¼æŠŠå‰©ä¸‹çš„å·¥ä½œåšå®Œåï¼Œæˆ‘è¿˜åšäº†ä¸€äº›å¤‡ä»½å·¥ä½œï¼ˆå¦‚å¯¼å‡º GPG å¯†é’¥ï¼‰ï¼Œæ”¾åœ¨äº†æˆ‘çš„ `$HOME` æ–‡ä»¶å¤¹é‡Œã€‚ç„¶ååº”è¯¥åšçš„äº‹æ˜¯æŠŠ `$HOME` ä¹ŸåŠ å…¥ `/etc/NIXOS_LUSTRATE` æ–‡ä»¶é‡Œã€‚æˆ‘æ²¡æœ‰æ‰§è¡Œè¿™ä¸€æ­¥éª¤,ä¸è¿‡ NixOS ä»ç„¶æ²¡æœ‰å°†åŸ `/home` æ”¾å…¥ `/old-root`ã€‚å…¶å®å®ƒä¹Ÿæ— æ³•æ”¾å…¥ï¼Œå› ä¸ºæˆ‘ `/home` åœ¨ç¡¬ç›˜ä¸­å•ç‹¬æœ‰ä¸€ä¸ªåˆ†åŒºä¸”å ç”¨äº†å·¨å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œä»¥è‡³äºæ— æ³•æŒªåˆ° `/old-root` ä¸­ã€‚å…¶å®è¿™æ˜¯ä¸€ä¸ªæœ‰é£é™©çš„æ“ä½œï¼Œè¿˜æ˜¯åœ¨ LUSTRARE æ–‡ä»¶é‡Œå£°æ˜å®ƒæ¯”è¾ƒå¥½ã€‚

å¸è½½äº†ä¸€äº›è½¯ä»¶ï¼Œä»¥ç»™æ–°ç³»ç»Ÿè…¾å‡ºæ¥å¾ˆå¤šç©ºé—´ã€‚æ¥ç€å°±å¼€å§‹å®‰è£…ç³»ç»Ÿäº†ã€‚

```bash
> sudo mv -v /boot /boot.bak &&
sudo /nix/var/nix/profiles/system/bin/switch-to-configuration boot
```

å®‰è£…æ¯”è¾ƒå¸¸è§çš„é—®é¢˜å°±æ˜¯ç½‘ç»œä¸ä½³ï¼Œä»¥è‡³äºæ— æ³•ä¸‹è½½ç›¸å…³çš„è½¯ä»¶åŒ…ã€‚è§£å†³çš„åŠæ³•å¯ä»¥æ˜¯æŒ‰ç…§æ‰‹å†Œä¸­æ‰€è¿°æŒ‚ä»£ç†æ¥å®‰è£…ï¼Œä¹Ÿå¯ä»¥å°† channel æ¢ä¸ºæ¸…åæº [nix | é•œåƒç«™ä½¿ç”¨å¸®åŠ© | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror](https://mirrors.tuna.tsinghua.edu.cn/help/nix/)ã€‚ä½ éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ‰‹å†Œä¸­é…ç½®çš„ channel æœ‰äº›ç‰¹æ®Šï¼Œå°† nixpkgs å¯¹åº”ä¸ºäº† nixos ä»“åº“ã€‚è¯·ä¸è¦ç›´æ¥ä½¿ç”¨æ¸…åæºä½¿ç”¨å¸®åŠ©çš„å‘½ä»¤ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘æƒ³æˆ‘ä»¬çŸ¥é“äº†åº”å½“å°½é‡ç²¾ç®€ç³»ç»Ÿé…ç½®çš„æ›´å¤šåŸå› ï¼š

* åœ¨åˆæ¬¡å®‰è£…æ—¶ä½ çš„å­˜å‚¨ç©ºé—´é‡Œæœ‰ä¸¤ä¸ªç³»ç»Ÿå¹¶å­˜ï¼Œæ‰€ä»¥å¯èƒ½ä½™é‡æœ‰é™ã€‚å¦‚æœåœ¨é…ç½®ä¸­å†™å…¥å¾ˆå¤šä¸œè¥¿ï¼Œä¼šå› ä¸ºä¸‹è½½ç©ºé—´ä¸è¶³è€Œå¤±è´¥ï¼›
* å¦‚æœä½ çš„ç½‘ç»œä¸å¤ªå¥½ï¼Œå£°æ˜è¶Šå¤æ‚ä»£è¡¨ç€è¦ä»è¿œç¨‹ä»“åº“é‡Œä¸‹è½½æ›´å¤šä¸œè¥¿ï¼Œå®‰è£…è¿‡ç¨‹ä¼šå› ä¸ºä¸å¥åº·çš„ç½‘ç»œè€Œè¢«æ‹–é•¿ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ã€‚

è‡³æ­¤ï¼Œåœ¨é‡æ–°å¯åŠ¨åæˆ‘è·å¾—äº†ä¸€ä»½å´­æ–°çš„ NixOS ç³»ç»Ÿï¼ŒNix ä¹‹æ—…ä¹Ÿå°†åœ¨è¿™é‡Œç»§ç»­ã€‚

```bash
> neofetch
          â–—â–„â–„â–„       â–—â–„â–„â–„â–„    â–„â–„â–„â––            yakkhini@nixos
          â–œâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–™  â–Ÿâ–ˆâ–ˆâ–ˆâ–›            --------------
           â–œâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–™â–Ÿâ–ˆâ–ˆâ–ˆâ–›             OS: NixOS 22.11.20230101.0bf3109 (Raccoon) x86_64
            â–œâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›              Host: Dell Inc. 0J8RVN
     â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–™ â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–›     â–Ÿâ–™        Kernel: 5.15.85
    â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–™ â–œâ–ˆâ–ˆâ–ˆâ–™    â–Ÿâ–ˆâ–ˆâ–™       Uptime: 3 hours, 50 mins
           â–„â–„â–„â–„â––           â–œâ–ˆâ–ˆâ–ˆâ–™  â–Ÿâ–ˆâ–ˆâ–ˆâ–›       Packages: 743 (nix-system), 4767 (nix-user)
          â–Ÿâ–ˆâ–ˆâ–ˆâ–›             â–œâ–ˆâ–ˆâ–› â–Ÿâ–ˆâ–ˆâ–ˆâ–›        Shell: zsh 5.9
         â–Ÿâ–ˆâ–ˆâ–ˆâ–›               â–œâ–› â–Ÿâ–ˆâ–ˆâ–ˆâ–›         CPU: Intel i5-8265U (8) @ 3.900GH
â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›                  â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–™   GPU: NVIDIA GeForce MX250
â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›                  â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›   GPU: Intel WhiskeyLake-U GT2 [UHD Graphics 620]
      â–Ÿâ–ˆâ–ˆâ–ˆâ–› â–Ÿâ–™               â–Ÿâ–ˆâ–ˆâ–ˆâ–›            Memory: 3613MiB / 7672MiB
     â–Ÿâ–ˆâ–ˆâ–ˆâ–› â–Ÿâ–ˆâ–ˆâ–™             â–Ÿâ–ˆâ–ˆâ–ˆâ–›             
    â–Ÿâ–ˆâ–ˆâ–ˆâ–›  â–œâ–ˆâ–ˆâ–ˆâ–™           â–â–€â–€â–€â–€              
    â–œâ–ˆâ–ˆâ–›    â–œâ–ˆâ–ˆâ–ˆâ–™ â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›        
     â–œâ–›     â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–™ â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›         
           â–Ÿâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–™               
          â–Ÿâ–ˆâ–ˆâ–ˆâ–›â–œâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–™
         â–Ÿâ–ˆâ–ˆâ–ˆâ–›  â–œâ–ˆâ–ˆâ–ˆâ–™       â–œâ–ˆâ–ˆâ–ˆâ–™
         â–â–€â–€â–€    â–€â–€â–€â–€â–˜       â–€â–€â–€â–˜
```

## åˆå…¥ NixOS é…ç½®

è¿›å…¥æ–°ç³»ç»Ÿä»¥åï¼Œå°±å¯ä»¥åœ¨ NixOS ä¸Šé€šè¿‡ `configuration.nix` å¼€å·¥äº†ï¼è¯·ä¸è¦ä½¿ç”¨ `nix-env` å®‰è£…è½¯ä»¶ï¼Œå› ä¸ºè¿™è¿èƒŒäº†ä½¿ç”¨ Nix çš„åˆè¡·â€”â€”å£°æ˜å¼é…ç½®ã€‚

### ä¸ºä»€ä¹ˆè¦å£°æ˜å¼åœ°æè¿°ç³»ç»Ÿçš„æ ·å­

è®°å¾—æˆ‘åœ¨ä¸€å¼€å§‹æåˆ°ä½¿ç”¨ Manjaro çš„å›°å¢ƒå—ï¼Ÿéšç€ä½¿ç”¨æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œæˆ‘çš„ç³»ç»Ÿé‡Œè½¯ä»¶æ•°é‡ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œé…ç½®æ–‡ä»¶ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ã€‚æ¥ç€å°±å‡ºç°ä¸€äº›éš¾ä»¥ç®¡ç†çš„é—®é¢˜ï¼šæˆ‘æä¸æ¸…æ¥šç³»ç»Ÿé‡Œçš„ä¸œè¥¿æ˜¯ç”±å“ªå‡ ä¸ªæ–‡ä»¶æ‰€é…ç½®å’Œå½±å“çš„ï¼Œä¹Ÿä¸çŸ¥é“æœ‰å¤šå°‘è½¯ä»¶æ˜¯åœ¨åˆ é™¤äº†å¦ä¸€ä¸ªä¸æƒ³è¦çš„è½¯ä»¶åç•™ä¸‹çš„ä¾èµ–ã€‚æˆ‘æˆ–è®¸å¯ä»¥é€šè¿‡ç®¡ç† dotfiles æ¥è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘å§‹ç»ˆæ‰¾ä¸åˆ°ä¸€ä¸ªç®€å•å¯è¡Œçš„ç®¡ç†æ–¹å¼ï¼›å…¶ä»–å‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨æœ‰å°è¯•è¿‡è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚ `apt autoremove` ä½†æˆ‘ä»¬çŸ¥é“å®ƒçš„æ•ˆæœå·®å¼ºäººæ„ã€‚

NixOS è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡å£°æ˜å¼çš„æè¿°ï¼Œæˆ‘å¯ä»¥åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°æˆ‘è£…äº†å“ªäº›è½¯ä»¶ï¼›ä¸€æ—¦å°†è½¯ä»¶çš„é…ç½®ä»æ–‡ä»¶ä¸­åˆ å»ï¼Œé‚£ä¹ˆåœ¨ `nixos-rebuild` åå…¶æ‰€ä¾èµ–ä¸”æˆ‘ä¸éœ€è¦çš„è½¯ä»¶è‡ªç„¶ä¼šæ¶ˆå¤±â€”â€”å¦‚æœæˆ‘éœ€è¦é‚£ä¸ªä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªè½¯ä»¶åŒ…è‚¯å®šä¼šåœ¨é…ç½®æ–‡ä»¶ä¸­è¢«å£°æ˜ï¼Œæˆ–è€…è¢«å£°æ˜çš„è½¯ä»¶æ‰€ä¾èµ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**æˆ‘å¸è½½çš„è½¯ä»¶éƒ½å¥½åƒä»æœªåœ¨æˆ‘çš„ç”µè„‘ä¸Šå®‰è£…è¿‡ä¸€æ ·**ï¼Œè¿™æ˜¯ NixOS reproducibility çš„é­”æ³•ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒNixOS çš„é…ç½®æ–‡ä»¶ä¸ä»…å¯ä»¥å£°æ˜è½¯ä»¶çš„å®‰è£…å’Œåˆ é™¤ï¼Œä¹Ÿå¯ä»¥å£°æ˜è½¯ä»¶çš„é…ç½®é€‰é¡¹ã€‚æ­é… **Home Manager** åï¼Œå°±å¯ä»¥åŸç”Ÿç®¡ç†ç³»ç»Ÿçš„ dotfiles äº†ã€‚åªéœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œ Git è¿½è¸ªï¼Œå°±ä¸æ€•ç³»ç»Ÿå˜å¾—ç³Ÿç³•ã€‚åªè¦é…ç½®æ–‡ä»¶çš„å†å²å’Œå¤‡ä»½å­˜åœ¨ï¼Œç³»ç»Ÿçš„æ¨¡æ ·ä¹Ÿå¯ä»¥éšæ—¶æ¢å¤ã€‚

æ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸¤å±‚é…ç½®â€”â€”ç³»ç»ŸåŸç”Ÿé…ç½®é€‰é¡¹å’Œ Home Manager é€‰é¡¹ã€‚

### åŸç”Ÿ Options

ç³»ç»ŸåŸç”Ÿé€‰é¡¹å¯ä»¥åœ¨ [NixOS Manual - Appendix A. Configuration Options](https://nixos.org/manual/nixos/stable/options.html) ä¸­æ‰¾åˆ°ã€‚è¿™äº›é…ç½®å°±æ˜¯ä¸æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆé…ç½®æ–‡ä»¶åŒä¸€ç±»çš„é…ç½®ï¼Œç”± NixOS åŸç”Ÿæä¾›ã€‚

### Home Manager æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥åšä»€ä¹ˆ

[**Home Manager**](https://github.com/nix-community/home-manager) ä½¿å¾—æˆ‘å¯ä»¥é‡‡ç”¨åœ¨ nix ä¸­å£°æ˜é…ç½®çš„æ–¹å¼æ¥å•ç‹¬ç®¡ç†ç”¨æˆ·ç¯å¢ƒã€‚å®ƒçš„å®‰è£…å’Œé…ç½®æ–¹æ³•åœ¨ [Home Manager Manual](https://nix-community.github.io/home-manager/) ä¸­æœ‰è®²è§£ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»–æœ‰ä¸¤ç§å®‰è£…æ–¹æ³•ï¼Œå³ Standalone installation ç‹¬ç«‹å®‰è£…å’Œä½œä¸º NixOS module å®‰è£…ã€‚ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒå¥½ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥åœ¨ `configuration.nix` ä¸­ä¸€èµ·é…ç½® Home Managerã€‚**ä¿æŒæˆ‘ä»¬çš„é…ç½®åœ¨åŒä¸€å¤„æœ‰åŠ©äºä¹‹åç»Ÿä¸€çš„è¿ç§»å’Œç®¡ç†**ã€‚

Home Manager é…ç½®é€‰é¡¹å¯ä»¥åœ¨ [Appendix A. Configuration Options](https://nix-community.github.io/home-manager/options.html) ä¸­æ‰¾åˆ°ã€‚

### é…ç½®

æˆ‘ä¸æƒ³æŠŠé…ç½®è¯´å¾—å¾ˆå…¨é¢ï¼Œè¿˜æ˜¯ä»ä¸­é€‰æ‹©äº†å‡ é¡¹é…ç½®ä½œä¸ºæ¡ˆä¾‹å±•ç¤ºï¼Œè¾¾åˆ°ä»¥ç‚¹å¸¦é¢ï¼Œå—äººä»¥æ¸”çš„æ•ˆæœã€‚Nix è¯­è¨€çš„é…ç½®å’Œ JSON æœ‰ç‚¹åƒï¼Œå®é™…ä¸Šåœ¨ä½ ç†Ÿæ‚‰äº† Nix è¯­æ³•åä¼šæ˜ç™½æˆ‘ä»¬çš„ `configuration.nix` æ–‡ä»¶å†…å®¹æ˜¯ä¸€ä¸ª Attribute Set ä¸ºç»“æœçš„ Functionã€‚ä¸è¿‡ä¸æ˜ç™½ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºè¿™äº›è¯¦ç»†è¯­æ³•å†…å®¹è‡³å°‘åˆ°ä½¿ç”¨ Flake ç®¡ç†ç³»ç»Ÿçš„é˜¶æ®µæ‰æ˜¯å¿…è¦å‰ç½®çŸ¥è¯†ã€‚

è€Œåœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘è®¤ä¸º **String çš„è½¬ä¹‰ä¸åµŒå¥—è¡¨è¾¾å¼** ç­‰æ˜¯éœ€è¦æå‰æŒæ¡çš„è¯­æ³•ã€‚åœ¨ [Nix Manual 5.1. Nix Language - Data Types](https://nixos.org/manual/nix/stable/language/values.html#type-string) å¯¹æ­¤æœ‰è¯¦ç»†è¡¨è¿°ã€‚å¦‚æœæƒ³æ·±å…¥å­¦ä¹  Nix Languageï¼Œåœ¨ä¸‹æ–¹çš„ **Nix Ecosystem è¿›é˜¶** ä¸€èŠ‚ä¸­æˆ‘æœ‰åˆ—ä¸¾ä¸€äº›æ–‡æ¡£ã€‚

NixOS Wiki ä¸ Arch Wiki æ˜¯ä¸é”™çš„æŸ¥é˜…èµ„æ–™ã€‚å¦‚æœä¸æ¸…æ¥šä¸€ä¸ªè½¯ä»¶è¯¥æ€æ ·é…ç½®ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå¯èƒ½ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„åœ°æ–¹ã€‚ä¸è¿‡ NixOS Wiki åŸºæœ¬æ˜¯åŠ Official çŠ¶æ€ï¼ˆWiki å®˜ç½‘æ ‡æ˜ Unofficialï¼Œä½†è¢«åˆ—ä¸¾åœ¨äº† nixos.orgï¼Œä»£è¡¨å®˜æ–¹æœ‰ä¸€å®šè®¤å¯åº¦ï¼‰ã€‚

#### Gitï¼ŒGnuPG é…ç½®

GnuPG éœ€è¦ enable å®ƒçš„ agentï¼Œå¹¶é…ç½®ä¸€ä¸ªç®€å•çš„éªŒè¯å›¾å½¢ç•Œé¢ã€‚

```nix
...
  gnupg.agent = {
    enable = true;
    enableSSHSupport = true;
    pinentryFlavor = "qt";
  };
...
```

æˆ‘ä½¿ç”¨ Home Manager æ¥ç®¡ç† Git é…ç½®ã€‚

```nix
...
  programs.git = {
    enable = true;
    signing.key = "??????";
    signing.signByDefault = true;
    userEmail = "??????";
    userName = "??????";
    extraConfig = {
      init.defaultBranch = "main";
    };
    delta.enable = true;
  };
  programs.gitui.enable = true;
...
```

#### i18n setting

æˆ‘çš„é»˜è®¤è¯­è¨€å…¶å®ä»æ˜¯ `en_US`ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…é‡‡ç”¨ä¸­æ–‡æ—¶ä¸€äº›è½¯ä»¶å‡ºç°è¿è¡Œé”™è¯¯çš„å¯èƒ½ï¼š

```nix
...
  i18n.defaultLocale = "en_US.UTF-8";
  i18n.extraLocaleSettings = {LANGUAGE = "en_US.UTF-8";};
  i18n.supportedLocales = ["en_US.UTF-8/UTF-8" "zh_CN.UTF-8/UTF-8"];
...
```

æˆ‘ä½¿ç”¨ fcitx5 æ­é… Rime å¼•æ“ä½œä¸ºè¾“å…¥æ³•ã€‚å¯ä»¥å»çœ‹çœ‹ Options æ”¯æŒå“ªäº›è¾“å…¥æ³•åŠå¼•æ“ã€‚

```nix
...
  # Input method
  i18n.inputMethod = {
    enabled = "fcitx5";
    fcitx.engines = with pkgs.fcitx-engines; [rime];
    fcitx5.enableRimeData = true;
    fcitx5.addons = with pkgs; [
      fcitx5-rime
      fcitx5-chinese-addons
      fcitx5-gtk
    ];
  };
...
```

è®°å¾—é…ç½®è¾“å…¥æ³•ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨ Archwiki ä¸­æ‰¾åˆ°é…ç½®å†…å®¹ï¼Œåœ¨ Home Manager Options ä¸­æ‰¾åˆ°é…ç½®æ–¹æ³•ã€‚

#### greetd å’Œ tuigreet

æˆ‘ä¹ æƒ¯ä½¿ç”¨çš„ window manager æ˜¯ swayï¼Œä¸è¿‡æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œè¯¦ç»†å°† Wayland ç›¸å…³çš„å›¾å½¢ç•Œé¢é…ç½®ï¼Œ**è¿™æ˜¯æœ¬æ–‡é˜¶æ®µæ€§çš„ä¸€ä¸ªå°ä½œä¸šï¼šæµè§ˆå‰æ–‡æåˆ°çš„ç›¸å…³èµ„æ–™æˆ–è‡ªè¡Œæœç´¢èµ„æ–™ï¼Œé…ç½®ä¸€ä¸ªå–œæ¬¢çš„å›¾å½¢ç•Œé¢ï¼ˆx11/wayland çš†å¯ï¼‰å¹¶ rebuild æˆåŠŸï¼Œç„¶åæ€»ç»“è‡ªå·±çš„æ”¶è·ã€‚**

æ­é… sway ä½¿ç”¨çš„ display manager æˆ‘é€‰æ‹©äº† greetd ä¸ tuigreetï¼Œä¸¥æ ¼æ¥è®² greetd å¹¶ä¸ç®—ä¸€ä¸ª display manager è€Œä»…æ˜¯ä¸€ä¸ª login managerï¼Œä¸è¿‡å…¶è½»é‡çš„ç‰¹æ€§è®©æˆ‘é’çã€‚

```nix
...
# greetd session manager to fit sway & Wayland.
  services.greetd = {
    enable = true;
    vt = 2;
    settings = rec {
      default_session = {
        command = "${pkgs.greetd.tuigreet}/bin/tuigreet --remember --time --cmd sway";
        user = "yakkhini";
      };
    };
  };

  services.xserver.displayManager.lightdm.enable = false;
...
```

è®°å¾—å…³é—­é»˜è®¤çš„ lightdmã€‚ä½¿ç”¨ Tuigreet ä¼šæœ‰æ±¡æŸ“ tty çš„é—®é¢˜ï¼Œæˆ‘æ‰¾åˆ°äº†è§£å†³åŠæ³• [github: apognu/tuigreet Issue #68, Yakkhini commented](https://github.com/apognu/tuigreet/issues/68#issuecomment-1368183430)ã€‚

```nix
...
  # pkgs: greetd, tuigreet
  systemd.services.greetd.serviceConfig = {
    Type = "idle";
  };
...
```

#### fontconfig

åœ¨ç³»ç»Ÿç•Œé¢é»˜è®¤çš„è‹±æ–‡å­—ä½“ï¼Œæˆ‘å¯¹ paratype å­—æ—æƒ…æœ‰ç‹¬é’Ÿã€‚

```nix
...
  # fonts
  fonts.fonts = with pkgs; [
    (nerdfonts.override {fonts = ["FiraCode" "Hack" "DroidSansMono"];})
    openmoji-color
    noto-fonts
    noto-fonts-cjk
    noto-fonts-emoji
    source-han-sans
    source-han-serif
    paratype-pt-sans
    paratype-pt-serif
    paratype-pt-mono
    fira-code
    fira-code-symbols
    dina-font
  ];
  fonts.fontconfig = {
    enable = true;
    defaultFonts = {
      emoji = ["Openmoji Color"];
      monospace = ["Hack Nerd Font Mono" "Noto Sans Mono CJK SC"];
      sansSerif = ["PT Sans" "Noto Sans Mono CJK SC"];
      serif = ["PT Serif" "Noto Serif Mono CJK SC"];
    };
  };
...
```

Nerd Fonts çš„ override æ–¹æ³•å°±æ˜¯åœ¨ NixOS Wiki ä¸­æ‰¾åˆ°çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä»æ¢ç´¢ä¸€äº› override ç‰¹æ€§å¼€å§‹ï¼Œä»¥å¦ä¸€ä¸ªè§†è§’æ¥æ¬£èµ NixOS çš„çµå·§ä¸å¼ºå¤§ã€‚

#### ç¬¬ä¸€æ¬¡ Overrideâ€”â€”é¼ æ ‡å’Œå›¾æ ‡ï¼Œä»¥åŠæˆ‘ä»¬çš„ä¸‹ä¸€æ­¥

æƒ³è¦ä¸ªæ€§åŒ–ç³»ç»Ÿç•Œé¢ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªæ¼‚äº®çš„å›¾æ ‡ä¸é¼ æ ‡ä¸»é¢˜ã€‚æˆ‘é€‰æ‹©äº† `pkgs.papirus-icon-theme` å’Œ `pkgs.hackneyed` ä¸»é¢˜ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜â€”â€”papirus å’Œ hackneyed éƒ½æœ‰å…¶å¯é€‰æ‹©çš„é…ç½®é¡¹ã€‚å¯¹äº papirus æ¥è¯´ï¼Œå…¶æ–‡ä»¶å¤¹çš„è‰²å½©æ˜¯å¯é…ç½®çš„ï¼Œè€Œ hackneyed å¯ä»¥é€‰æ‹©ç™½è‰²é»‘è‰²çš„é¼ æ ‡ï¼Œä½†æ˜¯é»˜è®¤ä»…å®‰è£…ç™½è‰²çš„é¼ æ ‡ã€‚

ä½†æ˜¯ï¼Œä» nix channel å®‰è£…çš„è¿™ä¸¤ä¸ªä¸»é¢˜å‡ä¸ºé»˜è®¤è‰²ï¼Œä¸”æ²¡æœ‰ç›¸å…³é…ç½®é¡¹ã€‚ä¸ºä»€ä¹ˆè¿™æ ·ï¼ŸåŸæ¥å°±å¦‚åŒä¸Šä¸€èŠ‚çš„ Nerd Fonts ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ä» package override å…¥æ‰‹ï¼Œæ”¹å˜è½¯ä»¶åŒ…çš„å®‰è£…æ–¹å¼ã€‚

Override é¡¾åæ€ä¹‰ **è¦†ç›–**ï¼Œå³é€šè¿‡æ”¹å˜è½¯ä»¶åŒ…æ‰“åŒ…çš„ `default.nix` è„šæœ¬ä¸­ä¸€äº›é€‰é¡¹ä»¥è¾¾åˆ°æ”¹å˜å®‰è£…åœ¨æœ¬åœ°è½¯ä»¶åŒ…æ ·å­çš„ç›®çš„ã€‚åœ¨ [Nixpkgs Manual Chapter 4. Overriding](https://nixos.org/manual/nixpkgs/stable/#chap-overrides) ä¸­è¯¦ç»†è®²è¿°äº†è¯¥æ€æ · override è½¯ä»¶åŒ…ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯Ÿè½¯ä»¶åŒ…çš„æ‰“åŒ…è„šæœ¬æ¥è€ƒè™‘æ€æ · override å®ƒä»¬ã€‚åœ¨ NixOS Official ä¸»é¡µçš„è½¯ä»¶åŒ…æœç´¢æ å¤„æœç´¢ç›¸å…³è½¯ä»¶åŒ…åç§°ï¼Œç‚¹å‡»ç»“æœæ¡ç›®çš„ ã€ŒğŸ“¦ Sourceã€å°±å¯ä»¥çœ‹åˆ°è½¯ä»¶åŒ…çš„è„šæœ¬ã€‚

æœ‰äº›è½¯ä»¶åŒ…çš„æ‰“åŒ…è„šæœ¬å‡½æ•°å‚æ•°é‡Œå°±å­˜åœ¨å¯é…ç½®é¡¹ï¼Œå¦‚ [papirus](https://github.com/NixOS/nixpkgs/blob/nixos-22.11/pkgs/data/icons/papirus-icon-theme/default.nix) ä¸­é¦–è¡Œçš„ `color ? null` ä»£è¡¨ç€ `color` å‚æ•°å¯é…ç½®ï¼Œç¼ºçœå€¼ä¸º `null`ã€‚

é…ç½®å…¶ overrideï¼š

```nix
...
  nixpkgs.config = {
    packageOverrides = pkgs: rec {
      papirus-icon-theme = pkgs.papirus-icon-theme.override {
        color = "adwaita";
      };
    };
  };
...
```

è€Œå½¢å¦‚ hackneyed åˆ™æ²¡æœ‰è¿™ä¹ˆæ–¹ä¾¿çš„è§£å†³æ–¹æ³•äº†ã€‚æˆ‘å¿…é¡»å‚è€ƒ [hackneyed ä»“åº“çš„ ç¼–è¯‘å¸®åŠ©](https://gitlab.com/Enthymeme/hackneyed-x11-cursors#building) override å®ƒçš„ buildFlagsï¼š

```nix
...
  nixpkgs.config = {
    packageOverrides = pkgs: rec {
      hackneyed = pkgs.hackneyed.overrideAttrs (finalAttrs: previousAttrs: {
        buildFlags = [
          "-j20"
          "-B"
          "THEME_NAME=Hackneyed-Dark"
          "COMMON_SOURCE=theme/common-dark.svg"
          "RSVG_SOURCE=theme/right-handed-dark.svg"
          "LSVG_SOURCE=theme/left-handed-dark.svg"
          "theme"
          "theme.left"
        ];
      });
    };
  };
...
```

è‡³æ­¤ï¼Œæ‰é¡ºåˆ©å®‰è£…å®Œè‡ªå®šä¹‰è¿‡çš„å›¾æ ‡å’Œé¼ æ ‡ä¸»é¢˜ã€‚è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å¼€å§‹æ¥è§¦ nix çš„ä¸€äº›é«˜çº§ç©æ³•ã€‚åœ¨ä¸‹ä¸€èŠ‚ï¼ŒNix ä¹‹æ—…å°†ä¼šé‚‚é€…æ›´å¤š Nix çš„è¿›é˜¶ä½¿ç”¨æ–¹å¼ã€‚

## Nix Ecosystem è¿›é˜¶

### Nix è¯­æ³•

### ä½¿ç”¨ Flakes æ¥ç®¡ç†ç³»ç»Ÿé…ç½®

### NUR ä»“åº“

## åè®°

## å‚è€ƒ

[*Nix Manual*](https://nixos.org/manual/nix/stable/)

[*NixOS Manual*](https://nixos.org/manual/nixos/stable/)

[*Nix - ArchWiki*](https://wiki.archlinux.org/title/Nix)

[*nix | é•œåƒç«™ä½¿ç”¨å¸®åŠ© | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror*](https://mirrors.tuna.tsinghua.edu.cn/help/nix/)

[*NixOS Wiki*](https://nixos.wiki/)

[*Home Manager Manual*](https://nix-community.github.io/home-manager/)